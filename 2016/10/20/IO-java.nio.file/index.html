<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>java.nio.file | Shawshank</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">java.nio.file</h1><a id="logo" href="/.">Shawshank</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">java.nio.file</h1><div class="post-meta">Oct 20, 2016</div><div class="post-content"><h2 id="java-nio-file的使用"><a href="#java-nio-file的使用" class="headerlink" title="java.nio.file的使用"></a>java.nio.file的使用</h2><p>这个包中最核心的概念就是 <code>Path</code>， 可以说 <code>Path</code> 是整个java.nio.file包和java.nio.file.attribute包中操作的目标，几乎所有的API都是围绕<code>Path</code>进行的。</p>
<h3 id="Path的获取"><a href="#Path的获取" class="headerlink" title="Path的获取"></a>Path的获取</h3><ul>
<li><p>通过 File 类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">"/file.txt"</span>);</span><br><span class="line">Path path = file.toPath();</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过 Paths 类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.getPath(<span class="string">"/file.txt"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过 FileSystem 类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileSystem fileSystem = FileSystems.getDefault();</span><br><span class="line">Path path = fileSystem.getPath(<span class="string">"/file.txt"</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>其中前两种方式，获得的是当前JVM默认的FileSystem来获取Path. </p>
<p>default file system：</p>
<blockquote>
<p>The default file system creates objects that provide access to the file systems accessible to the Java virtual machine.</p>
</blockquote>
<p>java.io.File 使用是就是JVM运行环境所在的文件系统。所以通过将两种方式获得的 Path 可以和 File 对象进行互操作。</p>
<p>FileSystems 类可以获得默认的文件系统，同时也提供了创建文件系统的方法。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得 zip 文件系统</span></span><br><span class="line">Map&lt;String, String&gt; env = <span class="keyword">new</span> HashMap&lt;&gt;(); </span><br><span class="line">env.put(<span class="string">"create"</span>, <span class="string">"true"</span>);</span><br><span class="line">URI uri = URI.create(<span class="string">"jar:file:/tmp/fszip.zip"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过下面的方式获得 zip 文件系统。</span></span><br><span class="line">FileSystem zipfs = FileSystems.newFileSystem(uri, env)</span><br><span class="line"><span class="comment">// 注意：此时获得的 Path 是 /tmp/fszip.zip 这个zip</span></span><br><span class="line"><span class="comment">// 压缩包中的 demo.txt 文件，而不是当前文件系统中的</span></span><br><span class="line"><span class="comment">// 文件。</span></span><br><span class="line">Path pathInZipfile = zipfs.getPath(<span class="string">"/demo.txt"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="FileSystem的获取"><a href="#FileSystem的获取" class="headerlink" title="FileSystem的获取"></a>FileSystem的获取</h3><ul>
<li>FileSystems.newFileSystem</li>
<li>path.getFileSystem</li>
</ul>
<p>第二种方式是通过 Path 类的实现，来获得其所在的文件系统的抽象 FileSystem</p>
<h2 id="FileSystem-amp-FileSystemProvider"><a href="#FileSystem-amp-FileSystemProvider" class="headerlink" title="FileSystem &amp; FileSystemProvider"></a>FileSystem &amp; FileSystemProvider</h2><p>wiki 中关于 File System 的描述：</p>
<blockquote>
<p>In computing, a file system or filesystem is used to control how data is stored and retrieved. Without a file system, information placed in a storage medium would be one large body of data with no way to tell where one piece of information stops and the next begins. By separating the data into pieces and giving each piece a name, the information is easily isolated and identified. Taking its name from the way paper-based information systems are named, each group of data is called a “file”. <strong>The structure and logic rules used to manage the groups of information and their names is called a “file system”.</strong></p>
</blockquote>
<p>可以看到文件系统，其实就是对数据如何存储的一种机制。从而有了目录和文件的概念，目录和文件就可以使用 Path 来表示。</p>
<p>同时对于一个目录和文件，文件系统可以提供一种抽象，就是对它们进行属性设置，例如：文件A 不能被执行。目录B 不可以被某个用户访问。这些信息，本身和文件数据（data）是没有任何关系，只是文件系统提供的一种属性，而这种属性则是存储在文件系统中的，所以 FileStore 可以用来表示这种抽象，通过FileStore可以查询到文件的属性。</p>
<p>基于目录层次文件系统抽象，还有一个概念就是根目录（RootDirectory）。所有新创建的文件和目录必然是从根目录开始的。</p>
<p>对于操作系统而言，文件系统提供了创建目录及文件的功能，自然对于文件的任何变化，例如文件属性的变化，文件内容的变化，都由文件系统来完成，则文件系统就可以提供一种机制，让用户（其它程序）监测文件的变化，如果文件发生变化，则这个程序可以得到通知。所以文件系统也应该能够提供 WatchService 的功能。</p>
<p>而上面的这些功能就可以接口的形式提供给用户，所以对于 java 中 FileSystem 类就像一个工厂一样，将一个文件系统所能提供的功能都以接口的形式提供出来：Path, PathMatcher,FileStore,UserPrincipalLookupService,WatchService 等等。</p>
<p>所以说 FileSystemProvider 中提供的仅仅是一个 文件系统 提供给用户的服务，例如：创建目录，创建文件等。</p>
<p>但 文件系统 并不等同于上面的服务。还有其存储元数据的信息等等。</p>
<p>所以说 将文件系统抽象为 FileSystem &amp; FileSystemProvider 这两个类，是比较清晰的表达的文件系统的概念。</p>
<p>其实可以把 FileSystemProvider 类的方法移到 FileSystem 中，从逻辑上讲也是没有问题的。可以参考 Hadoop 对 文件系统 的抽象，就是这么做的。</p>
<p>FileSystem:</p>
<blockquote>
<p>Provides an interface to a file system and is the factory for objects to access files and other objects in the file system.</p>
</blockquote>
<p>FileSystemProvider:</p>
<blockquote>
<p>Service-provider class for file systems. </p>
<p>A file system provider is a concrete implementation of this class that implements the abstract methods defined by this class.</p>
<p>A provider is identified by a URI scheme.</p>
<p>A provider is a factory for one or more FileSystem instances.</p>
</blockquote>
<ul>
<li><p>Path</p>
<p>  <code>FileSystem.getPath</code></p>
</li>
<li><p>PathMatcher</p>
<p>  <code>FileSystem.getPathMatcher</code></p>
</li>
<li><p>FileStore</p>
<p>  <code>FileSystem.getFileStores</code></p>
</li>
<li><p>UserPrincipalLookupService</p>
<p>  <code>FileSystem.getUserPrincipalLookupService</code></p>
</li>
<li><p>WatchService</p>
<p>  <code>FileSystem.newWatchService</code></p>
</li>
</ul>
<h2 id="JVM如何动态发现已经安装的Provider"><a href="#JVM如何动态发现已经安装的Provider" class="headerlink" title="JVM如何动态发现已经安装的Provider"></a>JVM如何动态发现已经安装的Provider</h2><p>通过 java.util.ServiceLoader</p>
<blockquote>
<p>A service provider is identified by placing a provider-configuration file in the resource directory META-INF/services. The file’s name is the fully-qualified binary name of the service’s type. The file contains a list of fully-qualified binary names of concrete provider classes, one per line.</p>
</blockquote>
<h2 id="WatchService-amp-Watchable"><a href="#WatchService-amp-Watchable" class="headerlink" title="WatchService &amp; Watchable"></a>WatchService &amp; Watchable</h2><p>WatchService 可以用来检测文件系统中目录的变化。其使用方法如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FileSystem fs = FileSystems.getDefault();</span><br><span class="line"></span><br><span class="line">Path path = Paths.get(<span class="string">"/temp"</span>);</span><br><span class="line">WatchService ws = fs.newWatchService();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Path 是一个 Watchable 对象。</span></span><br><span class="line"><span class="comment">// 所以可以注册一个需要关注的事件，</span></span><br><span class="line"><span class="comment">// 当事件发生时，就可以通过</span></span><br><span class="line">path.register(ws, StandardWatchEventKinds.ENTRY_CREATE);</span><br><span class="line"></span><br><span class="line">WatchKey take = ws.take();</span><br></pre></td></tr></table></figure>
<h3 id="WindowsWatchService"><a href="#WindowsWatchService" class="headerlink" title="WindowsWatchService"></a>WindowsWatchService</h3><p>windows 平台如何实现 WatchService：</p>
<h4 id="创建-WatchService"><a href="#创建-WatchService" class="headerlink" title="创建 WatchService"></a>创建 WatchService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Win32 implementation of WatchService based on ReadDirectoryChangesW.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WindowsWatchService</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractWatchService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">// background thread to service I/O completion port</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Poller poller;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Creates an I/O completion port and a daemon thread to service it</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WindowsWatchService(WindowsFileSystem fs) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	    <span class="comment">// create I/O completion port</span></span><br><span class="line">	    <span class="keyword">long</span> port = <span class="number">0L</span>;</span><br><span class="line">	    <span class="keyword">try</span> &#123;</span><br><span class="line">	    	<span class="comment">// 创建 IO 完成端口</span></span><br><span class="line">	    	<span class="comment">// If INVALID_HANDLE_VALUE is specified, the function creates an I/O completion port without associating it with a file handle. In this case, </span></span><br><span class="line">	    	<span class="comment">// the ExistingCompletionPort parameter must be NULL and the CompletionKey parameter is ignored.</span></span><br><span class="line">	    	<span class="comment">// 此时这个还没有还任何 handle(文件句柄) 关联。</span></span><br><span class="line">	        port = CreateIoCompletionPort(INVALID_HANDLE_VALUE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	    &#125; <span class="keyword">catch</span> (WindowsException x) &#123;</span><br><span class="line">	        <span class="keyword">throw</span> <span class="keyword">new</span> IOException(x.getMessage());</span><br><span class="line">	    &#125;</span><br><span class="line">	</span><br><span class="line">		<span class="comment">// 创建一个 轮询线程（Poller）</span></span><br><span class="line">	    <span class="keyword">this</span>.poller = <span class="keyword">new</span> Poller(fs, <span class="keyword">this</span>, port);</span><br><span class="line">	    <span class="keyword">this</span>.poller.start();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Poller的 run 方法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Poller main loop</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        CompletionStatus info = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	<span class="comment">// Attempts to dequeue an I/O completion packet from the specified I/O completion port. </span></span><br><span class="line">        	<span class="comment">// If there is no completion packet queued, the function waits for a pending I/O operation associated with the completion port to complete.</span></span><br><span class="line">        	<span class="comment">// 在完成端口处等待，直到有完成数据包返回。</span></span><br><span class="line">            info = GetQueuedCompletionStatus(port);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowsException x) &#123;</span><br><span class="line">            <span class="comment">// this should not happen</span></span><br><span class="line">            x.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// wakeup</span></span><br><span class="line">        <span class="keyword">if</span> (info.completionKey() == <span class="number">0</span>) &#123;</span><br><span class="line">        	<span class="comment">// 有新的事件需要注册</span></span><br><span class="line">        	<span class="comment">// 处理 requestList 对象</span></span><br><span class="line">        	<span class="comment">// 如果轮询器（Poller）被关闭（close）</span></span><br><span class="line">        	<span class="comment">// 则返回的 shutdown 为ture</span></span><br><span class="line">        	<span class="comment">// 从而轮询结束</span></span><br><span class="line">            <span class="keyword">boolean</span> shutdown = processRequests();</span><br><span class="line">            <span class="keyword">if</span> (shutdown) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// map completionKey to get WatchKey</span></span><br><span class="line">        WindowsWatchKey key = int2key.get(info.completionKey());</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// We get here when a registration is changed. In that case</span></span><br><span class="line">            <span class="comment">// the directory is closed which causes an event with the</span></span><br><span class="line">            <span class="comment">// old completion key.</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ReadDirectoryChangesW failed</span></span><br><span class="line">        <span class="keyword">if</span> (info.error() != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// buffer overflow</span></span><br><span class="line">            <span class="keyword">if</span> (info.error() == ERROR_NOTIFY_ENUM_DIR) &#123;</span><br><span class="line">                key.signalEvent(StandardWatchEventKinds.OVERFLOW, <span class="keyword">null</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// other error so cancel key</span></span><br><span class="line">                implCancelKey(key);</span><br><span class="line">                key.signal();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// process the events</span></span><br><span class="line">        <span class="keyword">if</span> (info.bytesTransferred() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            processEvents(key, info.bytesTransferred());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// insufficient buffer size</span></span><br><span class="line">            key.signalEvent(StandardWatchEventKinds.OVERFLOW, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// start read for next batch of changes</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ReadDirectoryChangesW(key.handle(),</span><br><span class="line">                                  key.buffer().address(),</span><br><span class="line">                                  CHANGES_BUFFER_SIZE,</span><br><span class="line">                                  key.watchSubtree(),</span><br><span class="line">                                  ALL_FILE_NOTIFY_EVENTS,</span><br><span class="line">                                  key.countAddress(),</span><br><span class="line">                                  key.overlappedAddress());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowsException x) &#123;</span><br><span class="line">            <span class="comment">// no choice but to cancel key</span></span><br><span class="line">            implCancelKey(key);</span><br><span class="line">            key.signal();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为目录的变化注册io完成端口。</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Register a directory for changes as follows:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. Open directory</span></span><br><span class="line"><span class="comment"> * 2. Read its attributes (and check it really is a directory)</span></span><br><span class="line"><span class="comment"> * 3. Assign completion key and associated handle with completion port</span></span><br><span class="line"><span class="comment"> * 4. Call ReadDirectoryChangesW to start (async) read of changes</span></span><br><span class="line"><span class="comment"> * 5. Create or return existing key representing registration</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function">Object <span class="title">implRegister</span><span class="params">(Path obj,</span></span></span><br><span class="line"><span class="function"><span class="params">                    Set&lt;? extends WatchEvent.Kind&lt;?&gt;&gt; events,</span></span></span><br><span class="line"><span class="function"><span class="params">                    WatchEvent.Modifier... modifiers)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    WindowsPath dir = (WindowsPath)obj;</span><br><span class="line">    <span class="keyword">boolean</span> watchSubtree = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FILE_TREE modifier allowed</span></span><br><span class="line">    <span class="keyword">for</span> (WatchEvent.Modifier modifier: modifiers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (modifier == ExtendedWatchEventModifier.FILE_TREE) &#123;</span><br><span class="line">            watchSubtree = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (modifier == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">            <span class="keyword">if</span> (modifier <span class="keyword">instanceof</span> com.sun.nio.file.SensitivityWatchEventModifier)</span><br><span class="line">                <span class="keyword">continue</span>; <span class="comment">// ignore</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Modifier not supported"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// open directory</span></span><br><span class="line">    <span class="comment">// 1. 打开目录</span></span><br><span class="line">    <span class="keyword">long</span> handle = -<span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        handle = CreateFile(dir.getPathForWin32Calls(),</span><br><span class="line">                            FILE_LIST_DIRECTORY,</span><br><span class="line">                            (FILE_SHARE_READ | FILE_SHARE_WRITE | FILE_SHARE_DELETE),</span><br><span class="line">                            OPEN_EXISTING,</span><br><span class="line">                            FILE_FLAG_BACKUP_SEMANTICS | FILE_FLAG_OVERLAPPED);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (WindowsException x) &#123;</span><br><span class="line">        <span class="keyword">return</span> x.asIOException(dir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> registered = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// read attributes and check file is a directory</span></span><br><span class="line">        <span class="comment">// 检测文件是否是目录，如果不是目录则抛出异常</span></span><br><span class="line">        WindowsFileAttributes attrs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            attrs = WindowsFileAttributes.readAttributes(handle);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowsException x) &#123;</span><br><span class="line">            <span class="keyword">return</span> x.asIOException(dir);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!attrs.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> NotDirectoryException(dir.getPathForExceptionMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 检测目录是否已经注册</span></span><br><span class="line">        <span class="comment">// check if this directory is already registered</span></span><br><span class="line">        FileKey fk = <span class="keyword">new</span> FileKey(attrs.volSerialNumber(),</span><br><span class="line">                                 attrs.fileIndexHigh(),</span><br><span class="line">                                 attrs.fileIndexLow());</span><br><span class="line">        WindowsWatchKey existing = fk2key.get(fk);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if already registered and we're not changing the subtree</span></span><br><span class="line">        <span class="comment">// modifier then simply update the event and return the key.</span></span><br><span class="line">        <span class="keyword">if</span> (existing != <span class="keyword">null</span> &amp;&amp; watchSubtree == existing.watchSubtree()) &#123;</span><br><span class="line">        	<span class="comment">// 如果目录已经注册，则将当前需要 registe 的事件</span></span><br><span class="line">        	<span class="comment">// 添加到 existing</span></span><br><span class="line">            existing.setEvents(events);</span><br><span class="line">            <span class="keyword">return</span> existing;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// unique completion key (skip 0)</span></span><br><span class="line">        <span class="comment">// IO 完成端口的 completionKey </span></span><br><span class="line">        <span class="keyword">int</span> completionKey = ++lastCompletionKey;</span><br><span class="line">        <span class="keyword">if</span> (completionKey == <span class="number">0</span>)</span><br><span class="line">            completionKey = ++lastCompletionKey;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// associate handle with completion port</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	<span class="comment">// Poller 对象创建的时候，会创建一个 port 对象。</span></span><br><span class="line">        	<span class="comment">// 这个 IO完成端口对象并没有和任何 handle 关联</span></span><br><span class="line">        	<span class="comment">// 调用下面的方法将 handle 和 port 关联起来。</span></span><br><span class="line">            CreateIoCompletionPort(handle, port, completionKey);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowsException x) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> IOException(x.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// allocate memory for events, including space for other structures</span></span><br><span class="line">        <span class="comment">// needed to do overlapped I/O</span></span><br><span class="line">        <span class="keyword">int</span> size = CHANGES_BUFFER_SIZE + SIZEOF_DWORD + SIZEOF_OVERLAPPED;</span><br><span class="line">        NativeBuffer buffer = NativeBuffers.getNativeBuffer(size);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> bufferAddress = buffer.address();</span><br><span class="line">        <span class="keyword">long</span> overlappedAddress = bufferAddress + size - SIZEOF_OVERLAPPED;</span><br><span class="line">        <span class="keyword">long</span> countAddress = overlappedAddress - SIZEOF_DWORD;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// start async read of changes to directory</span></span><br><span class="line">        <span class="comment">// 启动目录异步读</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ReadDirectoryChangesW(handle,</span><br><span class="line">                                  bufferAddress,</span><br><span class="line">                                  CHANGES_BUFFER_SIZE,</span><br><span class="line">                                  watchSubtree,</span><br><span class="line">                                  ALL_FILE_NOTIFY_EVENTS,</span><br><span class="line">                                  countAddress,</span><br><span class="line">                                  overlappedAddress);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WindowsException x) &#123;</span><br><span class="line">            buffer.release();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> IOException(x.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        WindowsWatchKey watchKey;</span><br><span class="line">        <span class="keyword">if</span> (existing == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// not registered so create new watch key</span></span><br><span class="line">            <span class="comment">// 创建一个 WindowsWatchKey</span></span><br><span class="line">            watchKey = <span class="keyword">new</span> WindowsWatchKey(dir, watcher, fk)</span><br><span class="line">                .init(handle, events, watchSubtree, buffer, countAddress,</span><br><span class="line">                      overlappedAddress, completionKey);</span><br><span class="line">            <span class="comment">// map file key to watch key</span></span><br><span class="line">            fk2key.put(fk, watchKey);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// directory already registered so need to:</span></span><br><span class="line">            <span class="comment">// 1. remove mapping from old completion key to existing watch key</span></span><br><span class="line">            <span class="comment">// 2. release existing key's resources (handle/buffer)</span></span><br><span class="line">            <span class="comment">// 3. re-initialize key with new handle/buffer</span></span><br><span class="line">            int2key.remove(existing.completionKey());</span><br><span class="line">            existing.releaseResources();</span><br><span class="line">            watchKey = existing.init(handle, events, watchSubtree, buffer,</span><br><span class="line">                countAddress, overlappedAddress, completionKey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// map completion map to watch key</span></span><br><span class="line">        int2key.put(completionKey, watchKey);</span><br><span class="line"></span><br><span class="line">        registered = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> watchKey;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!registered) CloseHandle(handle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WindowsWatchService 对象持有一个 Poller 对象。Poller 中持有一个 port 这是一个IO完成端口。</p>
<p>WindowsWatchService 被创建（FileSystem.newWatchService）时创建一个Poller 对象，然后调用 Poller 对象的 start 方法，start 方法中会启动一个线程。这个线程调用 Poller（实现了Runnable接口）的 run 方法。开始进行循环。这个循环的功能就是：</p>
<ol>
<li>在 io 完成端口上等待</li>
<li>上面的等待可能会返回，其返回的原因，可能是，被其它线程唤醒了</li>
<li>线程因为：Path.register 方法被唤醒，则是提交新的 Watch.Event</li>
<li>线程因为：WatchService.close 方法，Closes this watch service. 关闭 WatchService 就是关闭 Poller 的主循环。</li>
<li>线程因为：WatchKey.cancel 方法，Cancels the registration with the watch service.</li>
<li><p>上面三种方法，都调用 AbstractPoller.invoke 方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Enqueues request to poller thread and waits for result</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">invoke</span><span class="params">(RequestType type, Object... params)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 1. submit request</span></span><br><span class="line">    Request req = <span class="keyword">new</span> Request(type, params);</span><br><span class="line">    <span class="keyword">synchronized</span> (requestList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (shutdown) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClosedWatchServiceException();</span><br><span class="line">        &#125;</span><br><span class="line">        requestList.add(req);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. wakeup thread</span></span><br><span class="line">    <span class="comment">// 也就是唤醒 Poller 主循环</span></span><br><span class="line">    <span class="comment">// 处理请求 requestList 中的请求。</span></span><br><span class="line">    wakeup();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. wait for result</span></span><br><span class="line">    <span class="comment">// 等待请求的结束</span></span><br><span class="line">    Object result = req.awaitResult();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result <span class="keyword">instanceof</span> RuntimeException)</span><br><span class="line">        <span class="keyword">throw</span> (RuntimeException)result;</span><br><span class="line">    <span class="keyword">if</span> (result <span class="keyword">instanceof</span> IOException )</span><br><span class="line">        <span class="keyword">throw</span> (IOException)result;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果主循环是因为上面三种情况被循环则，在主循环中调用 processRequests用来相应请求</p>
</li>
<li>由于IO请求完成，而 main loop 被唤醒，则处理，返回事件。</li>
<li>调用 processEvents， 最终调用  key.signalEvent(kind, name);</li>
<li>key.signalEvent 最终 调用 signal 方法</li>
<li>signal 方法将 key 添加到 WatchService 的一个阻塞队列中</li>
<li><p>在 WatchService 上调用 take 方法的线程将，take 将从上面的队列中返回数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbstractWatchService</span></span><br><span class="line"><span class="comment">// signaled keys waiting to be dequeued</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> LinkedBlockingDeque&lt;WatchKey&gt; pendingKeys =</span><br><span class="line">       <span class="keyword">new</span> LinkedBlockingDeque&lt;WatchKey&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> WatchKey <span class="title">take</span><span class="params">()</span></span></span><br><span class="line"><span class="function">       <span class="keyword">throws</span> InterruptedException</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       checkOpen();</span><br><span class="line">       WatchKey key = pendingKeys.take();</span><br><span class="line">       checkKey(key);</span><br><span class="line">       <span class="keyword">return</span> key;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="查询和设置文件属性"><a href="#查询和设置文件属性" class="headerlink" title="查询和设置文件属性"></a>查询和设置文件属性</h2><p>文件属性相关的包 java.nio.file.attribute</p>
<h3 id="获得-FileAttributeView"><a href="#获得-FileAttributeView" class="headerlink" title="获得 FileAttributeView"></a>获得 FileAttributeView</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Files.getFileAttributeView</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Returns a file attribute view of a given type. </p>
</blockquote>
<h3 id="获得-FileStoreAttributeView"><a href="#获得-FileStoreAttributeView" class="headerlink" title="获得 FileStoreAttributeView"></a>获得 FileStoreAttributeView</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得 FileStore 对象</span></span><br><span class="line">Files.getFileStore</span><br><span class="line"><span class="comment">// 使用 FileStore 对象，获取FileStoreAttributeView</span></span><br><span class="line">FileStore.getFileStoreAttributeView</span><br></pre></td></tr></table></figure>
<h2 id="Files-类"><a href="#Files-类" class="headerlink" title="Files 类"></a>Files 类</h2><blockquote>
<p>This class consists exclusively of static methods that operate on files, directories, or other types of files. </p>
<p>Service-provider class for file systems. The methods defined by the Files class will typically delegate to an instance of this class(FileSystemProvider). </p>
</blockquote>
<p>这个类提供了关于文件系统的操作接口。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2016/10/24/network-TCP&amp;UDP/">TCP&amp;UDP</a><a class="next" href="/2016/10/20/磁盘存储与文件系统/">磁盘存储与文件系统</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/interface/" style="font-size: 15px;">interface</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/Collections/" style="font-size: 15px;">Collections</a> <a href="/tags/Collection/" style="font-size: 15px;">Collection</a> <a href="/tags/J-U-C/" style="font-size: 15px;">J.U.C</a> <a href="/tags/lock/" style="font-size: 15px;">lock</a> <a href="/tags/Semaphore/" style="font-size: 15px;">Semaphore</a> <a href="/tags/CyclicBarrier/" style="font-size: 15px;">CyclicBarrier</a> <a href="/tags/CountDownLatch/" style="font-size: 15px;">CountDownLatch</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/LinkedList/" style="font-size: 15px;">LinkedList</a> <a href="/tags/Queue/" style="font-size: 15px;">Queue</a> <a href="/tags/Set/" style="font-size: 15px;">Set</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/collection/" style="font-size: 15px;">collection</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/api/" style="font-size: 15px;">api</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/mvc/" style="font-size: 15px;">mvc</a> <a href="/tags/context/" style="font-size: 15px;">context</a> <a href="/tags/component-scan/" style="font-size: 15px;">component-scan</a> <a href="/tags/storm/" style="font-size: 15px;">storm</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/命令行/" style="font-size: 15px;">命令行</a> <a href="/tags/cmder/" style="font-size: 15px;">cmder</a> <a href="/tags/win/" style="font-size: 15px;">win</a> <a href="/tags/效率/" style="font-size: 15px;">效率</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/extends/" style="font-size: 15px;">extends</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/svn/" style="font-size: 15px;">svn</a> <a href="/tags/BlockingQueue/" style="font-size: 15px;">BlockingQueue</a> <a href="/tags/LinkedBlockingQueue/" style="font-size: 15px;">LinkedBlockingQueue</a> <a href="/tags/PriorityBlockingQueue/" style="font-size: 15px;">PriorityBlockingQueue</a> <a href="/tags/ConcurrentLinkedQueue/" style="font-size: 15px;">ConcurrentLinkedQueue</a> <a href="/tags/CopyOnWriteArrayList/" style="font-size: 15px;">CopyOnWriteArrayList</a> <a href="/tags/接口/" style="font-size: 15px;">接口</a> <a href="/tags/抽象类/" style="font-size: 15px;">抽象类</a> <a href="/tags/Executor/" style="font-size: 15px;">Executor</a> <a href="/tags/ExecutorService/" style="font-size: 15px;">ExecutorService</a> <a href="/tags/CompletionService/" style="font-size: 15px;">CompletionService</a> <a href="/tags/ThreadPoolExecutor/" style="font-size: 15px;">ThreadPoolExecutor</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/vundle/" style="font-size: 15px;">vundle</a> <a href="/tags/ArrayList/" style="font-size: 15px;">ArrayList</a> <a href="/tags/log/" style="font-size: 15px;">log</a> <a href="/tags/index/" style="font-size: 15px;">index</a> <a href="/tags/concepts/" style="font-size: 15px;">concepts</a> <a href="/tags/Timer/" style="font-size: 15px;">Timer</a> <a href="/tags/TimerTask/" style="font-size: 15px;">TimerTask</a> <a href="/tags/ConcurrentMap/" style="font-size: 15px;">ConcurrentMap</a> <a href="/tags/ConcurrentHashMap/" style="font-size: 15px;">ConcurrentHashMap</a> <a href="/tags/HashMap/" style="font-size: 15px;">HashMap</a> <a href="/tags/ReentrantReadWriteLock/" style="font-size: 15px;">ReentrantReadWriteLock</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/SynchronousQueue/" style="font-size: 15px;">SynchronousQueue</a> <a href="/tags/ScheduledExecutorService/" style="font-size: 15px;">ScheduledExecutorService</a> <a href="/tags/AQS/" style="font-size: 15px;">AQS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/21/BigData-docker/">Windows 上安装 docker</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/21/mysql-0.路线/">Mysql学习路线</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/21/mysql-索引/">Mysql安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/21/Qunar基础框架-QSchedule/">Qunar基础框架-QSchedule</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/21/java集合构架中使用到的数据结构和算法/">java集合构架中使用到的数据结构和算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/reids-调试环境搭建/">redis-调试环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/31/OpenStack-安装/">OpenStack-安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/26/JVM-hotspot-GC机制/">JVM-hotspot-GC机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/11/netty-socketio + socket.io 实现消息推送/">netty-socketio + socket.io 实现消息推送</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/26/mongodb-安装/">mongodb-安装</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/a-ray-of-sunshine" title="github" target="_blank">github</a><ul></ul><a href="http://www.cnblogs.com/a-ray-of-sunshine" title="cnblog" target="_blank">cnblog</a><ul></ul><a href="http://blog.csdn.net/a_ray_of_sunshine" title="csdn" target="_blank">csdn</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Shawshank.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>